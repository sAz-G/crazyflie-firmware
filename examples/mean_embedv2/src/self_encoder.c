#include "../include/self_encoder.h"
#include "../include/self_observation.h"

static const float psi_s_w0[PSI_S_V][PSI_S_H] = 
                                               {
{
-0.06618855893611908 ,
0.34523943066596985 ,
-0.3112786114215851 ,
0.13547925651073456 ,
-0.12269207090139389 ,
0.19081081449985504 ,
0.08459187299013138 ,
0.23935243487358093 ,
0.699114203453064 ,
-0.4368140995502472 ,
-0.08781720697879791 ,
0.7021660804748535 ,
0.329903781414032 ,
0.38129177689552307 ,
-0.1453278511762619 ,
0.1489643156528473 ,
-0.33259573578834534 ,
0.04298582673072815 ,
},
{
-0.4682655930519104 ,
-0.17655561864376068 ,
0.16594672203063965 ,
-0.2727769613265991 ,
0.25269660353660583 ,
0.05846159905195236 ,
-0.026889145374298096 ,
0.10265571624040604 ,
0.04853653907775879 ,
-0.08916362375020981 ,
-0.4914935529232025 ,
-0.5159429311752319 ,
0.16888202726840973 ,
0.10078997164964676 ,
-0.3050162196159363 ,
0.18041206896305084 ,
0.054078537970781326 ,
-0.19832105934619904 ,
},
{
0.23326344788074493 ,
-0.2490684539079666 ,
0.12214522063732147 ,
-0.0032051932066679 ,
-0.1882457584142685 ,
0.046793967485427856 ,
0.15089043974876404 ,
0.4143328368663788 ,
0.027854755520820618 ,
-0.504176676273346 ,
-0.26672059297561646 ,
-0.47665634751319885 ,
-0.10784818977117538 ,
-0.6814368367195129 ,
0.007555623073130846 ,
-0.2940790057182312 ,
0.07472864538431168 ,
-0.017174197360873222 ,
},
{
0.21436387300491333 ,
-0.14060582220554352 ,
0.27797189354896545 ,
0.4512733817100525 ,
0.19429822266101837 ,
-0.15254147350788116 ,
0.2180132269859314 ,
0.12546367943286896 ,
-0.2387508600950241 ,
-0.12866270542144775 ,
0.30586785078048706 ,
0.04716300219297409 ,
0.05521199479699135 ,
0.3990724980831146 ,
0.015742244198918343 ,
-0.015345738269388676 ,
-0.16942572593688965 ,
-0.027873311191797256 ,
},
{
-0.02455030381679535 ,
-0.22861914336681366 ,
0.05158013105392456 ,
-0.0038066646084189415 ,
0.042715076357126236 ,
-0.08573547750711441 ,
-0.3547452390193939 ,
-0.29483383893966675 ,
0.37012434005737305 ,
-0.3302658498287201 ,
-0.006350978743284941 ,
-0.6274789571762085 ,
-0.2724592685699463 ,
-0.027947982773184776 ,
-0.02325281873345375 ,
0.08664921671152115 ,
-0.022093789651989937 ,
0.22748404741287231 ,
},
{
-0.3313743770122528 ,
-0.21482554078102112 ,
0.1179249957203865 ,
0.18029309809207916 ,
-0.041821859776973724 ,
-0.3289237320423126 ,
0.16831021010875702 ,
0.2425520420074463 ,
0.3654761016368866 ,
-0.28557902574539185 ,
0.09221944957971573 ,
0.21197697520256042 ,
0.3930879235267639 ,
0.3006038963794708 ,
0.09013322740793228 ,
-0.005434525664895773 ,
-0.2338176816701889 ,
-0.08526260405778885 ,
},
{
-0.13932602107524872 ,
-0.2346857488155365 ,
0.013102566823363304 ,
-0.20200781524181366 ,
-0.3871012032032013 ,
0.30516886711120605 ,
-0.4132370948791504 ,
0.02928278036415577 ,
0.004397778771817684 ,
-0.04326285421848297 ,
-0.45791080594062805 ,
-0.011171729303896427 ,
0.18336284160614014 ,
0.16351661086082458 ,
-0.2134876549243927 ,
-0.25543007254600525 ,
-0.28080061078071594 ,
0.3193904459476471 ,
},
{
0.6233210563659668 ,
0.042757246643304825 ,
-0.2971605062484741 ,
0.38536226749420166 ,
0.16413600742816925 ,
-0.1368534415960312 ,
-0.029036615043878555 ,
0.19729532301425934 ,
0.6751405000686646 ,
-0.3662857711315155 ,
-0.42099130153656006 ,
0.2197422981262207 ,
0.04728676751255989 ,
0.1737658530473709 ,
0.5841560959815979 ,
0.3289170563220978 ,
-0.08733955025672913 ,
0.3056783974170685 ,
},
{
-0.008553671650588512 ,
0.09791561216115952 ,
-0.0659274235367775 ,
0.27104371786117554 ,
-0.1330069899559021 ,
-0.2631857395172119 ,
0.24940012395381927 ,
0.01987949199974537 ,
0.135589137673378 ,
0.14638282358646393 ,
-0.24199257791042328 ,
-0.030663825571537018 ,
0.12094713002443314 ,
-0.22435028851032257 ,
-0.1367831975221634 ,
0.017469581216573715 ,
-0.3493819534778595 ,
0.1585237830877304 ,
},
{
0.2641511857509613 ,
-0.033856987953186035 ,
-0.5515859127044678 ,
-0.27653029561042786 ,
-0.0681423544883728 ,
-0.4705716371536255 ,
-0.3218213617801666 ,
0.268984317779541 ,
-0.21794165670871735 ,
-0.08455868810415268 ,
-0.1270504593849182 ,
0.13759413361549377 ,
-0.36649763584136963 ,
-0.33180171251296997 ,
0.18127790093421936 ,
-0.26347601413726807 ,
-0.19761452078819275 ,
0.14276906847953796 ,
},
{
-0.22054821252822876 ,
0.2180703580379486 ,
0.010670223273336887 ,
-0.09295175969600677 ,
0.3626581132411957 ,
-0.02814868465065956 ,
0.059753384441137314 ,
0.05945969000458717 ,
-0.44936612248420715 ,
-0.13598717749118805 ,
-0.10051459074020386 ,
0.5787284970283508 ,
0.048852965235710144 ,
0.08273129165172577 ,
0.3912259340286255 ,
0.11663094907999039 ,
0.23215577006340027 ,
0.051532894372940063 ,
},
{
0.2816796898841858 ,
-0.5139243602752686 ,
-0.021655678749084473 ,
0.25801700353622437 ,
-0.15183305740356445 ,
0.2917014956474304 ,
-0.5456989407539368 ,
0.37711459398269653 ,
0.5211969614028931 ,
-0.3686465620994568 ,
-0.24667926132678986 ,
-0.3811739385128021 ,
-0.10574519634246826 ,
-0.5984392166137695 ,
0.0037465339992195368 ,
-0.36886200308799744 ,
-0.22335466742515564 ,
-0.0347084105014801 ,
},
{
-0.19181978702545166 ,
-0.10297846049070358 ,
-0.6120285987854004 ,
0.05835697427392006 ,
-0.16122664511203766 ,
-0.16578960418701172 ,
-0.3394419550895691 ,
-0.11585471779108047 ,
-0.04139780253171921 ,
-0.19347645342350006 ,
0.019921405240893364 ,
-0.6831509470939636 ,
-0.12976378202438354 ,
-0.07022816687822342 ,
0.23505598306655884 ,
-0.17346520721912384 ,
0.07783006131649017 ,
0.10484613478183746 ,
},
{
0.14063389599323273 ,
-0.06296567618846893 ,
0.040217626839876175 ,
-0.10225972533226013 ,
-0.19665837287902832 ,
-0.1071624681353569 ,
0.3122645318508148 ,
0.42305710911750793 ,
0.4699978828430176 ,
0.020055335015058517 ,
-0.4528962969779968 ,
0.3022986650466919 ,
-0.06134617328643799 ,
-0.014451928436756134 ,
0.05727379024028778 ,
-0.33531683683395386 ,
-0.11411971598863602 ,
0.28234004974365234 ,
},
{
0.224188432097435 ,
-0.13563241064548492 ,
-0.22148281335830688 ,
-0.2182742804288864 ,
-0.1892404407262802 ,
-0.29223981499671936 ,
0.06469226628541946 ,
-0.3096311688423157 ,
0.12274768948554993 ,
0.0945129320025444 ,
-0.14768922328948975 ,
-0.5201964378356934 ,
0.6107184290885925 ,
-0.08303523808717728 ,
-0.22463496029376984 ,
-0.033203985542058945 ,
-0.3552263379096985 ,
-0.3098936378955841 ,
},
{
-0.26053351163864136 ,
0.11999639868736267 ,
-0.2904934883117676 ,
-0.241376131772995 ,
-0.15075303614139557 ,
0.08241933584213257 ,
-0.4199342727661133 ,
0.47426438331604004 ,
-0.7421208024024963 ,
-0.3875903785228729 ,
0.30217909812927246 ,
0.1035190224647522 ,
-0.5520267486572266 ,
-0.20080284774303436 ,
0.03929801657795906 ,
-0.09347021579742432 ,
0.3027816712856293 ,
0.19080698490142822 ,
},
};




static const float psi_s_w1[PSI_S_V][PSI_S_V] = 
                                                    {
{
0.19581374526023865 ,
0.05332746356725693 ,
0.3671475052833557 ,
-0.11816670745611191 ,
0.2883707582950592 ,
0.09805718809366226 ,
0.07459037750959396 ,
0.5774343013763428 ,
0.08030841499567032 ,
0.42634108662605286 ,
0.4345746636390686 ,
0.47408321499824524 ,
0.38703516125679016 ,
0.30703306198120117 ,
-0.4089983403682709 ,
0.3013814687728882 ,
},
{
-0.16065792739391327 ,
0.4923967123031616 ,
-0.4202384352684021 ,
-0.14679580926895142 ,
-0.5153295993804932 ,
0.07500048726797104 ,
0.17594662308692932 ,
-0.04297741502523422 ,
-0.24216854572296143 ,
0.25096049904823303 ,
-0.0025555419269949198 ,
-0.41754093766212463 ,
-0.03258951008319855 ,
-0.24555787444114685 ,
0.1567835509777069 ,
0.37005263566970825 ,
},
{
-0.1325000375509262 ,
0.14053820073604584 ,
-0.2603161036968231 ,
0.25570032000541687 ,
-0.11609632521867752 ,
0.19535169005393982 ,
0.08342459052801132 ,
-0.050316255539655685 ,
0.21940535306930542 ,
-0.39512038230895996 ,
-0.4110617935657501 ,
0.18834659457206726 ,
0.0003189929702784866 ,
-0.22109191119670868 ,
-0.10921986401081085 ,
-0.11183945089578629 ,
},
{
0.23445087671279907 ,
0.15435799956321716 ,
0.11518771946430206 ,
0.08460529148578644 ,
-0.1793573498725891 ,
0.2779462933540344 ,
-0.23521775007247925 ,
0.27889612317085266 ,
-0.26846250891685486 ,
0.08318912237882614 ,
0.007828610949218273 ,
0.2949020564556122 ,
0.4560370445251465 ,
0.009220142848789692 ,
0.31856784224510193 ,
-0.2778151333332062 ,
},
{
0.06180119514465332 ,
0.3814096450805664 ,
0.15011733770370483 ,
0.09659798443317413 ,
-0.3914560377597809 ,
-0.3818823993206024 ,
-0.28866925835609436 ,
-0.05079246684908867 ,
-0.010944927111268044 ,
-0.0693226307630539 ,
0.4225703179836273 ,
0.12645526230335236 ,
-0.032490551471710205 ,
-0.2388203740119934 ,
0.08493030071258545 ,
-0.18733587861061096 ,
},
{
0.3495830297470093 ,
-0.15468858182430267 ,
-0.48493969440460205 ,
-0.22917425632476807 ,
-0.12637047469615936 ,
0.41460898518562317 ,
0.19886697828769684 ,
-0.18797722458839417 ,
0.28988078236579895 ,
-0.06942731142044067 ,
0.4208861291408539 ,
-0.21884146332740784 ,
0.29137036204338074 ,
-0.04862460866570473 ,
-0.21367397904396057 ,
0.3108842074871063 ,
},
{
0.028374124318361282 ,
-0.2457607537508011 ,
-0.04054353013634682 ,
-0.48396754264831543 ,
0.3395843207836151 ,
-0.03603888675570488 ,
0.3187422752380371 ,
-0.15215782821178436 ,
-0.36723583936691284 ,
-0.2976316511631012 ,
0.37865519523620605 ,
0.14656522870063782 ,
-0.21167893707752228 ,
-0.35353848338127136 ,
-0.20552080869674683 ,
-0.15328499674797058 ,
},
{
0.09368909895420074 ,
-0.31999167799949646 ,
0.2795336842536926 ,
0.2821887731552124 ,
0.2458709180355072 ,
0.3430365025997162 ,
-0.1856517344713211 ,
-0.3439840078353882 ,
-0.2312989979982376 ,
-0.45904114842414856 ,
0.1621704399585724 ,
0.1051386222243309 ,
-0.31147322058677673 ,
-0.11060307919979095 ,
0.21064451336860657 ,
0.09884366393089294 ,
},
{
0.11079078167676926 ,
-0.10002576559782028 ,
-0.17025648057460785 ,
-0.27860862016677856 ,
-0.2850319743156433 ,
0.3085187077522278 ,
-0.16945555806159973 ,
0.2798319458961487 ,
-0.2008955180644989 ,
0.3497118651866913 ,
-0.3115018904209137 ,
0.023411419242620468 ,
0.2167380452156067 ,
-0.23583242297172546 ,
0.08477360010147095 ,
-0.016774527728557587 ,
},
{
0.3523145020008087 ,
0.3996659219264984 ,
0.26734215021133423 ,
-0.02695808932185173 ,
0.04709378257393837 ,
0.24331238865852356 ,
0.2794255316257477 ,
-0.2523459792137146 ,
-0.1412642002105713 ,
0.3037402033805847 ,
-0.04928165674209595 ,
-0.30585676431655884 ,
-0.10885892063379288 ,
0.3144078850746155 ,
-0.4551626443862915 ,
-0.190111443400383 ,
},
{
0.013536926358938217 ,
-0.038242142647504807 ,
0.3622780442237854 ,
0.04222232475876808 ,
0.31369855999946594 ,
-0.10915331542491913 ,
-0.16676321625709534 ,
-0.34092631936073303 ,
0.13024665415287018 ,
0.31174159049987793 ,
0.06520876288414001 ,
0.00902643334120512 ,
0.3830718696117401 ,
0.11738694459199905 ,
0.18726173043251038 ,
-0.18879356980323792 ,
},
{
0.3174806833267212 ,
0.16982311010360718 ,
0.4505474865436554 ,
0.11477648466825485 ,
0.181072399020195 ,
0.1843860000371933 ,
0.36777523159980774 ,
-0.1562633216381073 ,
0.3390401601791382 ,
-0.07007114589214325 ,
-0.37639960646629333 ,
0.15829449892044067 ,
0.4353487193584442 ,
-0.021402141079306602 ,
0.11309585720300674 ,
-0.19487358629703522 ,
},
{
-0.40640783309936523 ,
0.07723691314458847 ,
0.1630631536245346 ,
-0.21727731823921204 ,
0.26731714606285095 ,
-0.09225142002105713 ,
0.21546384692192078 ,
-0.18759413063526154 ,
-0.27305230498313904 ,
0.15863002836704254 ,
-0.15371863543987274 ,
-0.21420226991176605 ,
0.11865925788879395 ,
-0.012150561437010765 ,
-0.2921326756477356 ,
0.23630563914775848 ,
},
{
-0.3491607904434204 ,
0.00671060336753726 ,
-0.12481006979942322 ,
-0.32594728469848633 ,
0.15742842853069305 ,
-0.01867188699543476 ,
0.08695615082979202 ,
-0.2756895124912262 ,
0.0558025948703289 ,
-0.18629370629787445 ,
-0.057327114045619965 ,
0.35915622115135193 ,
0.3783228397369385 ,
-0.170969158411026 ,
0.4058397114276886 ,
-0.23530614376068115 ,
},
{
0.3744545578956604 ,
-0.3703245222568512 ,
0.03131761774420738 ,
-0.2944566011428833 ,
0.4354444146156311 ,
0.07377612590789795 ,
0.39327019453048706 ,
0.26036307215690613 ,
-0.18300168216228485 ,
-0.33133548498153687 ,
0.036208316683769226 ,
0.44269993901252747 ,
0.010135279037058353 ,
0.15131765604019165 ,
0.3543039858341217 ,
-0.31990286707878113 ,
},
{
0.31518691778182983 ,
-0.21690918505191803 ,
-0.5966444611549377 ,
0.19880984723567963 ,
-0.22782321274280548 ,
-0.034392546862363815 ,
-0.22043579816818237 ,
0.45168307423591614 ,
0.3954538106918335 ,
-0.2791652977466583 ,
0.13510103523731232 ,
0.05483255535364151 ,
-0.5184333920478821 ,
0.07269381731748581 ,
-0.2341206967830658 ,
-0.16568030416965485 ,
},
};

static const float psi_s_b0[PSI_S_V] = {
0.22763897478580475 ,
0.03450649231672287 ,
0.2540818154811859 ,
-0.22258561849594116 ,
0.1145186722278595 ,
0.06184278428554535 ,
0.1488221287727356 ,
0.21545259654521942 ,
-0.16188707947731018 ,
0.11018897593021393 ,
0.22769995033740997 ,
0.38630837202072144 ,
0.21622708439826965 ,
0.05954987555742264 ,
0.14636629819869995 ,
0.17195001244544983 ,
};


static const float psi_s_b1[PSI_S_V] = {
0.11278434842824936 ,
0.0906004086136818 ,
0.012021685019135475 ,
0.03997240215539932 ,
0.1909482628107071 ,
0.1306123584508896 ,
-0.010342543013393879 ,
0.0697697103023529 ,
0.1582934856414795 ,
-0.11456869542598724 ,
0.06546904146671295 ,
0.04913822188973427 ,
0.09403806179761887 ,
0.2372099608182907 ,
0.0860084742307663 ,
0.08752262592315674 ,
};

static int       getSelfEncoderOutputSize();
static int       getSelfEncoderOutput0Size();
static int       getEncoderInputSize();

static void    feedForwardSelfEncoder(float* inp, float* dst);
static void    feedForwardPsiS(float* inp, float* dst);
static void    feedForwardPsiS0(float* inp, float* dst,int k);
static void    feedForwardPsiS1(float* inp, float* dst,int k);


void calcSelfEncoderOutput(float* inp, float* dst)
{
    feedForwardSelfEncoder(inp, dst);
}

static void feedForwardSelfEncoder(float* inp, float* dst)
{
    feedForwardPsiS(inp, dst);
}


static void  feedForwardPsiS(float* inp, float* dst)
{//YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY

    float out0[getSelfEncoderOutput0Size()];
    for(int k = 0; k < getSelfEncoderOutputSize(); k++)
    {
        feedForwardPsiS0(inp, out0, k);
    }   

    for(int k = 0; k < getSelfEncoderOutputSize(); k++)
    {
        feedForwardPsiS1(out0, dst, k);
    }   
}


static void feedForwardPsiS0(float* inp, float* out, int raw)
{//YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY
    int sz        = getEncoderInputSize();
    float temp    = 0.0;    

    for(int k = 0; k < sz; k++)
    {
        temp += psi_s_w0[raw][k]*inp[k];
    }

    out[raw] = (temp + psi_s_b0[raw]) >= 0.0f ? temp + psi_s_b0[raw] : 0.0f;
}

static void feedForwardPsiS1(float* inp, float* out, int raw)
{//YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY
    int sz        = getSelfEncoderOutputSize();
    float temp    = 0.0;    

    for(int k = 0; k < sz; k++)
    {
        temp += psi_s_w1[raw][k]*inp[k];
    }

    out[raw] = (temp + psi_s_b1[raw]) >= 0.0f ? temp + psi_s_b1[raw] : 0.0f;
}


static int getEncoderInputSize()
{
    return (int)PSI_S_H;
}

static int getSelfEncoderOutputSize()
{
    return (int)PSI_S_V;
}

static int getSelfEncoderOutput0Size()
{
    return (int)PSI_S_V;
}

